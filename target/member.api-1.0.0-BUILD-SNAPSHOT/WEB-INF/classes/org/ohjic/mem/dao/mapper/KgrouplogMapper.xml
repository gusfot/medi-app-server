<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.medi.hs.dao.KgrouplogMapper">
  <resultMap id="BaseResultMap" type="com.medi.hs.model.Kgrouplog">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Aug 31 22:00:43 KST 2016.
    -->
    <id column="no" jdbcType="INTEGER" property="no" />
    <result column="start_date" jdbcType="INTEGER" property="startDate" />
    <result column="end_date" jdbcType="INTEGER" property="endDate" />
    <result column="sortNo" jdbcType="INTEGER" property="sortNo" />
    <result column="attend_type" jdbcType="VARCHAR" property="attendType" />
    <result column="year" jdbcType="INTEGER" property="year" />
    <result column="k_part_idx" jdbcType="INTEGER" property="kPartIdx" />
    <result column="group_no" jdbcType="INTEGER" property="groupNo" />
    <result column="group_name" jdbcType="VARCHAR" property="groupName" />
    <result column="depth1_name" jdbcType="VARCHAR" property="depth1Name" />
    <result column="depth2_name" jdbcType="VARCHAR" property="depth2Name" />
    <result column="depth3_name" jdbcType="VARCHAR" property="depth3Name" />
    <result column="depth4_name" jdbcType="VARCHAR" property="depth4Name" />
    <result column="depth5_name" jdbcType="VARCHAR" property="depth5Name" />
    <result column="depth1" jdbcType="INTEGER" property="depth1" />
    <result column="depth2" jdbcType="INTEGER" property="depth2" />
    <result column="depth3" jdbcType="INTEGER" property="depth3" />
    <result column="depth4" jdbcType="INTEGER" property="depth4" />
    <result column="depth5" jdbcType="INTEGER" property="depth5" />
    <result column="tid" jdbcType="INTEGER" property="tid" />
    <result column="position" jdbcType="INTEGER" property="position" />
    <result column="position_name" jdbcType="VARCHAR" property="positionName" />
    <result column="position_ord" jdbcType="INTEGER" property="positionOrd" />
    <result column="name" jdbcType="VARCHAR" property="name" />
    <result column="chief" jdbcType="INTEGER" property="chief" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Aug 31 22:00:43 KST 2016.
    -->
    no, start_date, end_date, sortNo, attend_type, year, k_part_idx, group_no, group_name, 
    depth1_name, depth2_name, depth3_name, depth4_name, depth5_name, depth1, depth2, 
    depth3, depth4, depth5, tid, position, position_name, position_ord, name, chief
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Aug 31 22:00:43 KST 2016.
    -->
    select 
    <include refid="Base_Column_List" />
    from ${church}.kGroupLog
    where no = #{no,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Aug 31 22:00:43 KST 2016.
    -->
    delete from ${church}.kGroupLog
    where no = #{no,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.medi.hs.model.Kgrouplog">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Aug 31 22:00:43 KST 2016.
    -->
    insert into ${church}.kGroupLog (no, start_date, end_date, 
      sortNo, attend_type, year, 
      k_part_idx, group_no, group_name, 
      depth1_name, depth2_name, depth3_name, 
      depth4_name, depth5_name, depth1, 
      depth2, depth3, depth4, 
      depth5, tid, position, 
      position_name, position_ord, name, 
      chief)
    values (#{no,jdbcType=INTEGER}, #{startDate,jdbcType=INTEGER}, #{endDate,jdbcType=INTEGER}, 
      #{sortNo,jdbcType=INTEGER}, #{attendType,jdbcType=VARCHAR}, #{year,jdbcType=INTEGER}, 
      #{kPartIdx,jdbcType=INTEGER}, #{groupNo,jdbcType=INTEGER}, #{groupName,jdbcType=VARCHAR}, 
      #{depth1Name,jdbcType=VARCHAR}, #{depth2Name,jdbcType=VARCHAR}, #{depth3Name,jdbcType=VARCHAR}, 
      #{depth4Name,jdbcType=VARCHAR}, #{depth5Name,jdbcType=VARCHAR}, #{depth1,jdbcType=INTEGER}, 
      #{depth2,jdbcType=INTEGER}, #{depth3,jdbcType=INTEGER}, #{depth4,jdbcType=INTEGER}, 
      #{depth5,jdbcType=INTEGER}, #{tid,jdbcType=INTEGER}, #{position,jdbcType=INTEGER}, 
      #{positionName,jdbcType=VARCHAR}, #{positionOrd,jdbcType=INTEGER}, #{name,jdbcType=VARCHAR}, 
      #{chief,jdbcType=INTEGER})
  </insert>
  <insert id="insertSelective" parameterType="com.medi.hs.model.Kgrouplog">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Aug 31 22:00:43 KST 2016.
    -->
    insert into ${church}.kGroupLog
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="no != null">
        no,
      </if>
      <if test="startDate != null">
        start_date,
      </if>
      <if test="endDate != null">
        end_date,
      </if>
      <if test="sortNo != null">
        sortNo,
      </if>
      <if test="attendType != null">
        attend_type,
      </if>
      <if test="year != null">
        year,
      </if>
      <if test="kPartIdx != null">
        k_part_idx,
      </if>
      <if test="groupNo != null">
        group_no,
      </if>
      <if test="groupName != null">
        group_name,
      </if>
      <if test="depth1Name != null">
        depth1_name,
      </if>
      <if test="depth2Name != null">
        depth2_name,
      </if>
      <if test="depth3Name != null">
        depth3_name,
      </if>
      <if test="depth4Name != null">
        depth4_name,
      </if>
      <if test="depth5Name != null">
        depth5_name,
      </if>
      <if test="depth1 != null">
        depth1,
      </if>
      <if test="depth2 != null">
        depth2,
      </if>
      <if test="depth3 != null">
        depth3,
      </if>
      <if test="depth4 != null">
        depth4,
      </if>
      <if test="depth5 != null">
        depth5,
      </if>
      <if test="tid != null">
        tid,
      </if>
      <if test="position != null">
        position,
      </if>
      <if test="positionName != null">
        position_name,
      </if>
      <if test="positionOrd != null">
        position_ord,
      </if>
      <if test="name != null">
        name,
      </if>
      <if test="chief != null">
        chief,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="no != null">
        #{no,jdbcType=INTEGER},
      </if>
      <if test="startDate != null">
        #{startDate,jdbcType=INTEGER},
      </if>
      <if test="endDate != null">
        #{endDate,jdbcType=INTEGER},
      </if>
      <if test="sortNo != null">
        #{sortNo,jdbcType=INTEGER},
      </if>
      <if test="attendType != null">
        #{attendType,jdbcType=VARCHAR},
      </if>
      <if test="year != null">
        #{year,jdbcType=INTEGER},
      </if>
      <if test="kPartIdx != null">
        #{kPartIdx,jdbcType=INTEGER},
      </if>
      <if test="groupNo != null">
        #{groupNo,jdbcType=INTEGER},
      </if>
      <if test="groupName != null">
        #{groupName,jdbcType=VARCHAR},
      </if>
      <if test="depth1Name != null">
        #{depth1Name,jdbcType=VARCHAR},
      </if>
      <if test="depth2Name != null">
        #{depth2Name,jdbcType=VARCHAR},
      </if>
      <if test="depth3Name != null">
        #{depth3Name,jdbcType=VARCHAR},
      </if>
      <if test="depth4Name != null">
        #{depth4Name,jdbcType=VARCHAR},
      </if>
      <if test="depth5Name != null">
        #{depth5Name,jdbcType=VARCHAR},
      </if>
      <if test="depth1 != null">
        #{depth1,jdbcType=INTEGER},
      </if>
      <if test="depth2 != null">
        #{depth2,jdbcType=INTEGER},
      </if>
      <if test="depth3 != null">
        #{depth3,jdbcType=INTEGER},
      </if>
      <if test="depth4 != null">
        #{depth4,jdbcType=INTEGER},
      </if>
      <if test="depth5 != null">
        #{depth5,jdbcType=INTEGER},
      </if>
      <if test="tid != null">
        #{tid,jdbcType=INTEGER},
      </if>
      <if test="position != null">
        #{position,jdbcType=INTEGER},
      </if>
      <if test="positionName != null">
        #{positionName,jdbcType=VARCHAR},
      </if>
      <if test="positionOrd != null">
        #{positionOrd,jdbcType=INTEGER},
      </if>
      <if test="name != null">
        #{name,jdbcType=VARCHAR},
      </if>
      <if test="chief != null">
        #{chief,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.medi.hs.model.Kgrouplog">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Aug 31 22:00:43 KST 2016.
    -->
    update ${church}.kGroupLog
    <set>
      <if test="startDate != null">
        start_date = #{startDate,jdbcType=INTEGER},
      </if>
      <if test="endDate != null">
        end_date = #{endDate,jdbcType=INTEGER},
      </if>
      <if test="sortNo != null">
        sortNo = #{sortNo,jdbcType=INTEGER},
      </if>
      <if test="attendType != null">
        attend_type = #{attendType,jdbcType=VARCHAR},
      </if>
      <if test="year != null">
        year = #{year,jdbcType=INTEGER},
      </if>
      <if test="kPartIdx != null">
        k_part_idx = #{kPartIdx,jdbcType=INTEGER},
      </if>
      <if test="groupNo != null">
        group_no = #{groupNo,jdbcType=INTEGER},
      </if>
      <if test="groupName != null">
        group_name = #{groupName,jdbcType=VARCHAR},
      </if>
      <if test="depth1Name != null">
        depth1_name = #{depth1Name,jdbcType=VARCHAR},
      </if>
      <if test="depth2Name != null">
        depth2_name = #{depth2Name,jdbcType=VARCHAR},
      </if>
      <if test="depth3Name != null">
        depth3_name = #{depth3Name,jdbcType=VARCHAR},
      </if>
      <if test="depth4Name != null">
        depth4_name = #{depth4Name,jdbcType=VARCHAR},
      </if>
      <if test="depth5Name != null">
        depth5_name = #{depth5Name,jdbcType=VARCHAR},
      </if>
      <if test="depth1 != null">
        depth1 = #{depth1,jdbcType=INTEGER},
      </if>
      <if test="depth2 != null">
        depth2 = #{depth2,jdbcType=INTEGER},
      </if>
      <if test="depth3 != null">
        depth3 = #{depth3,jdbcType=INTEGER},
      </if>
      <if test="depth4 != null">
        depth4 = #{depth4,jdbcType=INTEGER},
      </if>
      <if test="depth5 != null">
        depth5 = #{depth5,jdbcType=INTEGER},
      </if>
      <if test="tid != null">
        tid = #{tid,jdbcType=INTEGER},
      </if>
      <if test="position != null">
        position = #{position,jdbcType=INTEGER},
      </if>
      <if test="positionName != null">
        position_name = #{positionName,jdbcType=VARCHAR},
      </if>
      <if test="positionOrd != null">
        position_ord = #{positionOrd,jdbcType=INTEGER},
      </if>
      <if test="name != null">
        name = #{name,jdbcType=VARCHAR},
      </if>
      <if test="chief != null">
        chief = #{chief,jdbcType=INTEGER},
      </if>
    </set>
    where no = #{no,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.medi.hs.model.Kgrouplog">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Aug 31 22:00:43 KST 2016.
    -->
    update ${church}.kGroupLog
    set start_date = #{startDate,jdbcType=INTEGER},
      end_date = #{endDate,jdbcType=INTEGER},
      sortNo = #{sortNo,jdbcType=INTEGER},
      attend_type = #{attendType,jdbcType=VARCHAR},
      year = #{year,jdbcType=INTEGER},
      k_part_idx = #{kPartIdx,jdbcType=INTEGER},
      group_no = #{groupNo,jdbcType=INTEGER},
      group_name = #{groupName,jdbcType=VARCHAR},
      depth1_name = #{depth1Name,jdbcType=VARCHAR},
      depth2_name = #{depth2Name,jdbcType=VARCHAR},
      depth3_name = #{depth3Name,jdbcType=VARCHAR},
      depth4_name = #{depth4Name,jdbcType=VARCHAR},
      depth5_name = #{depth5Name,jdbcType=VARCHAR},
      depth1 = #{depth1,jdbcType=INTEGER},
      depth2 = #{depth2,jdbcType=INTEGER},
      depth3 = #{depth3,jdbcType=INTEGER},
      depth4 = #{depth4,jdbcType=INTEGER},
      depth5 = #{depth5,jdbcType=INTEGER},
      tid = #{tid,jdbcType=INTEGER},
      position = #{position,jdbcType=INTEGER},
      position_name = #{positionName,jdbcType=VARCHAR},
      position_ord = #{positionOrd,jdbcType=INTEGER},
      name = #{name,jdbcType=VARCHAR},
      chief = #{chief,jdbcType=INTEGER}
    where no = #{no,jdbcType=INTEGER}
  </update>
  
  <select id="selectKGroupLogByGrouNOAndMinYear" parameterType="map" resultMap="BaseResultMap">
  	select 
    <include refid="Base_Column_List" />
    from ${church}.kGroupLog
    where group_no = #{groupNo} and year = #{year}
  </select>
  
  <insert id="insertSelectiveKgroupLog" parameterType="com.medi.hs.model.Kgrouplog">
    insert into ${church}.kGroupLog
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="no != null">
        no,
      </if>
      <if test="startDate != null">
        start_date,
      </if>
      <if test="endDate != null">
        end_date,
      </if>
      <if test="sortNo != null">
        sortNo,
      </if>
      <if test="attendType != null">
        attend_type,
      </if>
      <if test="year != null">
        year,
      </if>
      <if test="kPartIdx != null">
        k_part_idx,
      </if>
      <if test="groupNo != null">
        group_no,
      </if>
      <if test="groupName != null">
        group_name,
      </if>
      <if test="depth1Name != null">
        depth1_name,
      </if>
      <if test="depth2Name != null">
        depth2_name,
      </if>
      <if test="depth3Name != null">
        depth3_name,
      </if>
      <if test="depth4Name != null">
        depth4_name,
      </if>
      <if test="depth5Name != null">
        depth5_name,
      </if>
      <if test="depth1 != null">
        depth1,
      </if>
      <if test="depth2 != null">
        depth2,
      </if>
      <if test="depth3 != null">
        depth3,
      </if>
      <if test="depth4 != null">
        depth4,
      </if>
      <if test="depth5 != null">
        depth5,
      </if>
      <if test="tid != null">
        tid,
      </if>
      <if test="position != null">
        position,
      </if>
      <if test="positionName != null">
        position_name,
      </if>
      <if test="positionOrd != null">
        position_ord,
      </if>
      <if test="name != null">
        name,
      </if>
      <if test="chief != null">
        chief,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="no != null">
        #{no,jdbcType=INTEGER},
      </if>
      <if test="startDate != null">
        <!-- UNIX_TIMESTAMP(STR_TO_DATE('#{year}-01-01'),'%Y-%m-%d'), -->
        0,
      </if>
      <if test="endDate != null">
        <!-- UNIX_TIMESTAMP(STR_TO_DATE('(#{year}+1)-01-01'),'%Y-%m-%d')-1, -->
        0,
      </if>
      <if test="sortNo != null">
        #{sortNo,jdbcType=INTEGER},
      </if>
      <if test="attendType != null">
        #{attendType,jdbcType=VARCHAR},
      </if>
      <if test="year != null">
        #{year,jdbcType=INTEGER},
      </if>
      <if test="kPartIdx != null">
        #{kPartIdx,jdbcType=INTEGER},
      </if>
      <if test="groupNo != null">
        #{groupNo,jdbcType=INTEGER},
      </if>
      <if test="groupName != null">
        #{groupName,jdbcType=VARCHAR},
      </if>
      <if test="depth1Name != null">
        #{depth1Name,jdbcType=VARCHAR},
      </if>
      <if test="depth2Name != null">
        #{depth2Name,jdbcType=VARCHAR},
      </if>
      <if test="depth3Name != null">
        #{depth3Name,jdbcType=VARCHAR},
      </if>
      <if test="depth4Name != null">
        #{depth4Name,jdbcType=VARCHAR},
      </if>
      <if test="depth5Name != null">
        #{depth5Name,jdbcType=VARCHAR},
      </if>
      <if test="depth1 != null">
        #{depth1,jdbcType=INTEGER},
      </if>
      <if test="depth2 != null">
        #{depth2,jdbcType=INTEGER},
      </if>
      <if test="depth3 != null">
        #{depth3,jdbcType=INTEGER},
      </if>
      <if test="depth4 != null">
        #{depth4,jdbcType=INTEGER},
      </if>
      <if test="depth5 != null">
        #{depth5,jdbcType=INTEGER},
      </if>
      <if test="tid != null">
        #{tid,jdbcType=INTEGER},
      </if>
      <if test="position != null">
        #{position,jdbcType=INTEGER},
      </if>
      <if test="positionName != null">
        #{positionName,jdbcType=VARCHAR},
      </if>
      <if test="positionOrd != null">
        #{positionOrd,jdbcType=INTEGER},
      </if>
      <if test="name != null">
        #{name,jdbcType=VARCHAR},
      </if>
      <if test="chief != null">
        #{chief,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  
  <select id="selectKgrouplogByYear" parameterType="com.medi.hs.model.Kgrouplog" resultMap="BaseResultMap">
  select     
  	<include refid="Base_Column_List" />
  from ${church}.kGroupLog where year=#{year}
  </select>
  
  <insert id="insertNextYearKgrouplogByYear" parameterType="com.medi.hs.vo.YearVo">
  insert into ${church}.kGroupLog(start_date, end_date, sortNo, attend_type, year, k_part_idx, group_no, group_name, depth1_name, depth2_name, depth3_name, depth4_name, depth5_name, depth1, depth2, depth3, depth4, depth5, tid, position, position_name, position_ord, name, chief)
	select 
	 UNIX_TIMESTAMP(concat(#{startDate}, ' 00:00:00')) start_date, 
	 UNIX_TIMESTAMP(concat(#{endDate}, ' 23:59:59')) end_date, 
	 sortNo, attend_type, #{nextYear} year, a.k_part_idx, group_no, group_name, depth1_name, depth2_name, depth3_name, depth4_name, depth5_name, depth1, depth2, depth3, depth4, depth5, a.tid, position, position_name, position_ord, name, chief
	 from ${church}.kGroupLog a
	inner join ${church}.k_part b on a.k_part_idx=b.k_part_idx and b.active=1
	inner join ${church}.member c on c.tid=a.tid and c.cDepth1 <![CDATA[>=]]> 0
	where a.year=#{year} and UNIX_TIMESTAMP(STR_TO_DATE(#{standardDate},'%Y-%m-%d')) between start_date and end_date
	<if test="kPartIdx != null">
	and a.k_part_idx = #{kPartIdx}
	</if> 
  </insert>
  
  <update id="updateNextYearKgrouplogDepthByYear" parameterType="com.medi.hs.vo.DepthVo">
  update ${church}.kGroupLog a
	inner join ${church}.kGroup b on a.k_part_idx=b.k_part_idx and b.no > 0 and b.year=#{nextYear} and b.depth=#{depth}
	<if test="depth>=1">
		and a.depth1_name=b.depth1_name
	</if> 
	<if test="depth>=2">
		and a.depth2_name=b.depth2_name
	</if>
	<if test="depth>=3"> 
		and a.depth3_name=b.depth3_name
	</if>
	<if test="depth>=4"> 
		and a.depth4_name=b.depth4_name
	</if>
	<if test="depth>=5"> 
		and a.depth5_name=b.depth5_name
	</if> 
		set a.group_no=b.no
	<if test="depth>=1">
		, a.depth1=b.depth1
	</if>
	<if test="depth>=2">
		, a.depth2=b.depth2
	</if>
	<if test="depth>=3">
		, a.depth3=b.depth3
	</if>
	<if test="depth>=4">
		, a.depth4=b.depth4
	</if>
	<if test="depth>=5">
		, a.depth5=b.depth5
	</if>
  where a.no> 0 and a.year=#{nextYear} and a.k_part_idx=#{kPartIdx}
  </update>
  
  <delete id="deleteNextYearKgroupLog" parameterType="com.medi.hs.vo.YearVo">
  	delete from ${church}.kGroupLog where no <![CDATA[>]]> 0 and year=#{nextYear} and k_part_idx = #{kPartIdx}
  </delete>
  
</mapper>