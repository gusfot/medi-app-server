<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.ohjic.mem.dao.AuthInChargeMapper">
  <resultMap id="BaseResultMap" type="org.ohjic.mem.model.AuthInCharge">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Dec 21 18:33:33 KST 2016.
    -->
    <result column="auth_set_idx" jdbcType="INTEGER" property="authSetIdx" />
    <result column="manager_idx" jdbcType="INTEGER" property="managerIdx" />
    <result column="group_no" jdbcType="INTEGER" property="groupNo" />
    <result column="reg_date" jdbcType="TIMESTAMP" property="regDate" />
  </resultMap>
  <insert id="insert" parameterType="org.ohjic.mem.model.AuthInCharge">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Dec 21 18:33:33 KST 2016.
    -->
    insert into ${church}.auth_in_charge (auth_set_idx, manager_idx, group_no, 
      reg_date)
    values (#{authSetIdx,jdbcType=INTEGER}, #{managerIdx,jdbcType=INTEGER}, #{groupNo,jdbcType=INTEGER}, 
      #{regDate,jdbcType=TIMESTAMP})
  </insert>
  <insert id="insertSelective" parameterType="org.ohjic.mem.model.AuthInCharge">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Dec 21 18:33:33 KST 2016.
    -->
    insert into ${church}.auth_in_charge
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="authSetIdx != null">
        auth_set_idx,
      </if>
      <if test="managerIdx != null">
        manager_idx,
      </if>
      <if test="groupNo != null">
        group_no,
      </if>
      <if test="regDate != null">
        reg_date,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="authSetIdx != null">
        #{authSetIdx,jdbcType=INTEGER},
      </if>
      <if test="managerIdx != null">
        #{managerIdx,jdbcType=INTEGER},
      </if>
      <if test="groupNo != null">
        #{groupNo,jdbcType=INTEGER},
      </if>
      <if test="regDate != null">
        #{regDate,jdbcType=TIMESTAMP},
      </if>
    </trim>
  </insert>
  
  <insert id="insertAuthInChargeForNextYear" parameterType="org.ohjic.mem.vo.YearVo">
  insert into ${church}.auth_in_charge (auth_set_idx,manager_idx,group_no)
	select a2.auth_set_idx,ai.manager_idx,k2.no
	from ${church}.auth_in_charge ai
	inner join ${church}.auth_set a on ai.auth_set_idx = a.auth_set_idx
	inner join ${church}.auth_set a2 on a.year=2016 and a2.year=2017 and a.auth_category_idx = a2.auth_category_idx and a.auth_set_kind = a2.auth_set_kind
	inner join ${church}.kGroup k on ai.group_no = k.no 
	inner join ${church}.kGroup k2 on k.year = #{year} and k2.year = #{nextYear} and k.depth1_name = k2.depth1_name and k.depth2_name = k2.depth2_name
	    							and k.depth3_name = k2.depth3_name and k.depth4_name = k2.depth4_name and k.depth5_name = k2.depth5_name
	<where>
		<if test="kPartIdx != null and kPartIdx != 0 ">
			k.k_part_idx = #{kPartIdx}
		</if>
	</where>
  </insert>
  
  <delete id="deleteNextYearAuthInCharge" parameterType="org.ohjic.mem.vo.YearVo">
  delete from ${church}.auth_in_charge 
  where auth_set_idx in (select auth_set_idx from ${church}.auth_set where year=#{nextYear} and k_part=#{kPartIdx})
  </delete>
</mapper>