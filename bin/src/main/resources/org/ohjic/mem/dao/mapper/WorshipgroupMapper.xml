<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.ohjic.mem.dao.WorshipgroupMapper">
  <resultMap id="BaseResultMap" type="org.ohjic.mem.model.Worshipgroup">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Dec 21 21:38:10 KST 2016.
    -->
    <result column="year" jdbcType="INTEGER" property="year" />
    <result column="groupNo" jdbcType="INTEGER" property="groupNo" />
    <result column="worshipCode" jdbcType="INTEGER" property="worshipCode" />
    <result column="groupName" jdbcType="VARCHAR" property="groupName" />
    <result column="reg_date" jdbcType="TIMESTAMP" property="regDate" />
  </resultMap>
  <insert id="insert" parameterType="org.ohjic.mem.model.Worshipgroup">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Dec 21 21:38:10 KST 2016.
    -->
    insert into ${church}.worshipGroup (year, groupNo, worshipCode, 
      groupName, reg_date)
    values (#{year,jdbcType=INTEGER}, #{groupNo,jdbcType=INTEGER}, #{worshipCode,jdbcType=INTEGER}, 
      #{groupName,jdbcType=VARCHAR}, #{regDate,jdbcType=TIMESTAMP})
  </insert>
  <insert id="insertSelective" parameterType="org.ohjic.mem.model.Worshipgroup">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Dec 21 21:38:10 KST 2016.
    -->
    insert into ${church}.worshipGroup
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="year != null">
        year,
      </if>
      <if test="groupNo != null">
        groupNo,
      </if>
      <if test="worshipCode != null">
        worshipCode,
      </if>
      <if test="groupName != null">
        groupName,
      </if>
      <if test="regDate != null">
        reg_date,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="year != null">
        #{year,jdbcType=INTEGER},
      </if>
      <if test="groupNo != null">
        #{groupNo,jdbcType=INTEGER},
      </if>
      <if test="worshipCode != null">
        #{worshipCode,jdbcType=INTEGER},
      </if>
      <if test="groupName != null">
        #{groupName,jdbcType=VARCHAR},
      </if>
      <if test="regDate != null">
        #{regDate,jdbcType=TIMESTAMP},
      </if>
    </trim>
  </insert>
  
  <insert id="insertWorshipGroupForNextYear" parameterType="org.ohjic.mem.vo.YearVo">
  insert into ${church}.worshipGroup(year, groupNo, worshipCode, groupName)
	select x.year, x.no groupNo, worshipCode, x.group_name groupName  from ${church}.kGroup x
	inner join 
	(select wg.year, wg.groupNo, worshipCode, group_name, k.k_part_idx, k.depth1_name, k.depth2_name, k.depth3_name, k.depth4_name, k.depth5_name, depth from ${church}.worshipGroup wg
	inner join (select a.* from ${church}.kGroup a inner join ${church}.k_part b on a.k_part_idx=b.k_part_idx and b.active=1 and a.year=#{year} ) k on wg.groupNo=k.no 
	where wg.year=#{year} 
	) y
	on x.year=#{nextYear} and x.k_part_idx=y.k_part_idx and x.depth1_name=y.depth1_name and x.depth2_name=y.depth2_name and x.depth3_name=y.depth3_name and x.depth4_name=y.depth4_name and x.depth5_name=y.depth5_name
	<where>
		<if test="kPartIdx != null and kPartIdx !=0 ">
		x.k_part_idx =#{kPartIdx}
		</if>
	</where>
  </insert>
  
  <delete id="deleteNextYearWorship" parameterType="org.ohjic.mem.vo.YearVo">
  delete a from ${church}.worshipGroup a
  inner join ${church}.kGroup b on a.groupNo=b.`no` and b.year=#{nextYear} and b.k_part_idx=#{kPartIdx}
  </delete>
</mapper>