<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.ohjic.mem.dao.AuthSetMapper">
  <resultMap id="BaseResultMap" type="org.ohjic.mem.model.AuthSet">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Dec 21 18:33:33 KST 2016.
    -->
    <id column="auth_set_idx" jdbcType="INTEGER" property="authSetIdx" />
    <result column="auth_category_idx" jdbcType="INTEGER" property="authCategoryIdx" />
    <result column="auth_set_kind" jdbcType="INTEGER" property="authSetKind" />
    <result column="year" jdbcType="INTEGER" property="year" />
    <result column="k_part" jdbcType="INTEGER" property="kPart" />
    <result column="group_no" jdbcType="INTEGER" property="groupNo" />
    <result column="active" jdbcType="TINYINT" property="active" />
    <result column="reg_date" jdbcType="TIMESTAMP" property="regDate" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Dec 21 18:33:33 KST 2016.
    -->
    auth_set_idx, auth_category_idx, auth_set_kind, year, k_part, group_no, active, reg_date
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Dec 21 18:33:33 KST 2016.
    -->
    select 
    <include refid="Base_Column_List" />
    from ${church}.auth_set
    where auth_set_idx = #{authSetIdx,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Dec 21 18:33:33 KST 2016.
    -->
    delete from ${church}.auth_set
    where auth_set_idx = #{authSetIdx,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="org.ohjic.mem.model.AuthSet">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Dec 21 18:33:33 KST 2016.
    -->
    insert into ${church}.auth_set (auth_set_idx, auth_category_idx, auth_set_kind, 
      year, k_part, group_no, 
      active, reg_date)
    values (#{authSetIdx,jdbcType=INTEGER}, #{authCategoryIdx,jdbcType=INTEGER}, #{authSetKind,jdbcType=INTEGER}, 
      #{year,jdbcType=INTEGER}, #{kPart,jdbcType=INTEGER}, #{groupNo,jdbcType=INTEGER}, 
      #{active,jdbcType=TINYINT}, #{regDate,jdbcType=TIMESTAMP})
  </insert>
  <insert id="insertSelective" parameterType="org.ohjic.mem.model.AuthSet">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Dec 21 18:33:33 KST 2016.
    -->
    insert into ${church}.auth_set
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="authSetIdx != null">
        auth_set_idx,
      </if>
      <if test="authCategoryIdx != null">
        auth_category_idx,
      </if>
      <if test="authSetKind != null">
        auth_set_kind,
      </if>
      <if test="year != null">
        year,
      </if>
      <if test="kPart != null">
        k_part,
      </if>
      <if test="groupNo != null">
        group_no,
      </if>
      <if test="active != null">
        active,
      </if>
      <if test="regDate != null">
        reg_date,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="authSetIdx != null">
        #{authSetIdx,jdbcType=INTEGER},
      </if>
      <if test="authCategoryIdx != null">
        #{authCategoryIdx,jdbcType=INTEGER},
      </if>
      <if test="authSetKind != null">
        #{authSetKind,jdbcType=INTEGER},
      </if>
      <if test="year != null">
        #{year,jdbcType=INTEGER},
      </if>
      <if test="kPart != null">
        #{kPart,jdbcType=INTEGER},
      </if>
      <if test="groupNo != null">
        #{groupNo,jdbcType=INTEGER},
      </if>
      <if test="active != null">
        #{active,jdbcType=TINYINT},
      </if>
      <if test="regDate != null">
        #{regDate,jdbcType=TIMESTAMP},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="org.ohjic.mem.model.AuthSet">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Dec 21 18:33:33 KST 2016.
    -->
    update ${church}.auth_set
    <set>
      <if test="authCategoryIdx != null">
        auth_category_idx = #{authCategoryIdx,jdbcType=INTEGER},
      </if>
      <if test="authSetKind != null">
        auth_set_kind = #{authSetKind,jdbcType=INTEGER},
      </if>
      <if test="year != null">
        year = #{year,jdbcType=INTEGER},
      </if>
      <if test="kPart != null">
        k_part = #{kPart,jdbcType=INTEGER},
      </if>
      <if test="groupNo != null">
        group_no = #{groupNo,jdbcType=INTEGER},
      </if>
      <if test="active != null">
        active = #{active,jdbcType=TINYINT},
      </if>
      <if test="regDate != null">
        reg_date = #{regDate,jdbcType=TIMESTAMP},
      </if>
    </set>
    where auth_set_idx = #{authSetIdx,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="org.ohjic.mem.model.AuthSet">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Dec 21 18:33:33 KST 2016.
    -->
    update ${church}.auth_set
    set auth_category_idx = #{authCategoryIdx,jdbcType=INTEGER},
      auth_set_kind = #{authSetKind,jdbcType=INTEGER},
      year = #{year,jdbcType=INTEGER},
      k_part = #{kPart,jdbcType=INTEGER},
      group_no = #{groupNo,jdbcType=INTEGER},
      active = #{active,jdbcType=TINYINT},
      reg_date = #{regDate,jdbcType=TIMESTAMP}
    where auth_set_idx = #{authSetIdx,jdbcType=INTEGER}
  </update>
  
  <insert id="insertAuthSetForGroup" parameterType="org.ohjic.mem.vo.YearVo">
  insert into ${church}.auth_set (auth_category_idx, auth_set_kind,year,k_part,group_no,active)
	select a.auth_category_idx,a.auth_set_kind,k2.year,k2.k_part_idx,k2.no,a.active
	from ${church}.kGroup k
	inner join ${church}.kGroup k2
	on k2.year = #{nextYear} and k.k_part_idx=k2.k_part_idx and k.depth=k2.depth and k2.year = #{nextYear} and k.depth1_name = k2.depth1_name and ifnull(k.depth2_name,'') = ifnull(k2.depth2_name,'')
	    and ifnull(k.depth3_name,'') = ifnull(k2.depth3_name,'') and ifnull(k.depth4_name,'') = ifnull(k2.depth4_name,'') and ifnull(k.depth5_name,'') = ifnull(k2.depth5_name,'')
	inner join ${church}.auth_set a
	on k.year = a.year and k.no = a.group_no
	where k.year=#{year} and k.k_part_idx = #{kPartIdx}
  </insert>
  
  <insert id="insertAuthSetForDefault" parameterType="org.ohjic.mem.vo.YearVo">
	insert into ${church}.auth_set (auth_category_idx, auth_set_kind, year,k_part,group_no,active)
	select auth_category_idx,auth_set_kind,#{nextYear},0,null,1
	from ${church}.auth_set
	where year=#{year} and k_part = 0 and group_no is null
  </insert>  
  
  <delete id="deleteNextYearAuthSet" parameterType="org.ohjic.mem.vo.YearVo">
    delete from ${church}.auth_set where year=#{nextYear} and k_part=#{kPartIdx}
  </delete>
</mapper>